---
import PlotFigure from "./PlotFigure.astro";
import * as Plot from "@observablehq/plot";
import penguins from "../assets/penguins.json";

interface Props { 
  species: "Adelie" | "Gentoo" | "Chinstrap"; 
  title?: string;
}

const { species, title = `Analyse morphologique — ${species}` } = Astro.props;

const data = penguins.filter(
  (d) =>
    d.species === species &&
    d.culmen_length_mm != null &&
    d.culmen_depth_mm != null
);

const speciesColors = {
  Adelie: "#FF6B6B",
  Gentoo: "#4ECDC4", 
  Chinstrap: "#45B7D1"
};

const options = {
  width: 900,
  height: 520,
  marginTop: 40,
  marginRight: 40,
  marginBottom: 60,
  marginLeft: 80,
  style: {
    backgroundColor: "#fafafa",
    fontFamily: "Inter, system-ui, sans-serif"
  },
  marks: [
    Plot.dot(data, {
      x: "culmen_length_mm",
      y: "culmen_depth_mm",
      r: 4,
      fill: speciesColors[species],
      stroke: "#ffffff",
      strokeWidth: 0.5,
      opacity: 0.85,
      tip: {
        format: {
          x: (d) => `${d}mm`,
          y: (d) => `${d}mm`
        }
      }
    }),
    Plot.frame({stroke: "#e5e7eb", strokeWidth: 1})
  ],
  x: { 
    label: "Longueur du bec (mm)", 
    grid: true,
    tickSize: 6,
    labelAnchor: "center"
  },
  y: { 
    label: "Profondeur du bec (mm)", 
    grid: true,
    tickSize: 6,
    labelAnchor: "center"
  },
  color: { legend: false }
};
---

<div class="bg-white rounded-xl shadow-lg p-8 border border-gray-100">
  <div class="mb-6">
    <div class="flex items-center justify-between mb-3">
      <h2 class="text-3xl font-bold text-white tracking-tight">
        {title}
      </h2>
      <div class="flex items-center space-x-2">
        <div 
          class="w-4 h-4 rounded-full shadow-sm" 
          style={`background-color: ${speciesColors[species]}`}
        ></div>
        <span class="text-sm font-medium text-white">{species}</span>
      </div>
    </div>
    
    <div class="flex items-center space-x-4 text-sm text-gray-500">
      <span class="flex items-center">
        <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        {data.length} spécimens analysés
      </span>
      <span class="flex items-center">
        <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
        </svg>
        Données morphométriques
      </span>
    </div>
  </div>

  <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-4 shadow-inner">
    <PlotFigure options={options} />
  </div>
  
  <div class="mt-4 pt-4 border-t border-gray-100">
    <p class="text-xs text-gray-400 text-center">
      Relation entre la longueur et la profondeur du bec chez <em>{species}</em>
    </p>
  </div>
</div>

<style>
  div {
    font-feature-settings: "tnum";
  }
  
  h2 {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
</style>